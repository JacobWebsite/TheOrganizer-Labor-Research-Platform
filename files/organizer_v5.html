<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Organizer — Labor Research Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Source+Sans+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="/files/css/organizer.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cream: '#faf9f7',
                        warmgray: {
                            100: '#f5f3f0',
                            200: '#e8e5e0',
                            300: '#d4d0c8',
                            400: '#a8a298',
                            500: '#7d7770',
                            600: '#5c5752',
                            700: '#3d3935',
                            800: '#2a2725',
                            900: '#1a1a1a'
                        },
                        accent: {
                            red: '#c41e3a',
                            redDark: '#9e1830',
                            redLight: '#e8d4d8'
                        }
                    },
                    fontFamily: {
                        'headline': ['"Playfair Display"', 'serif'],
                        'body': ['"Source Sans Pro"', 'sans-serif']
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-cream min-h-screen">
    <!-- ============================================ -->
    <!-- HEADER -->
    <!-- ============================================ -->
    <header class="bg-warmgray-900 text-white">
        <div class="max-w-7xl mx-auto px-6 py-5">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-6">
                    <div>
                        <h1 class="headline text-2xl font-bold tracking-tight">The Organizer</h1>
                        <p class="text-warmgray-400 text-sm mt-0.5">Labor Research Tool</p>
                    </div>
                    <!-- App Mode Toggle -->
                    <div class="inline-flex gap-1 p-1 bg-warmgray-800 rounded-full">
                        <button id="modeTerritory" onclick="setAppMode('territory')"
                            class="app-mode-active px-4 py-1.5 text-sm font-semibold rounded-full transition-all">
                            Territory
                        </button>
                        <button id="modeSearch" onclick="setAppMode('search')"
                            class="app-mode-inactive px-4 py-1.5 text-sm font-semibold rounded-full transition-all">
                            Search
                        </button>
                    </div>
                </div>
                <div class="flex items-center gap-8 text-sm">
                    <button onclick="openAnalyticsDashboard()"
                        class="flex items-center gap-2 px-4 py-2 bg-warmgray-800 hover:bg-warmgray-700 rounded-lg transition-colors"
                        title="Analytics Dashboard">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        <span>Analytics</span>
                    </button>
                    <div class="text-right">
                        <div class="text-warmgray-400">Workers</div>
                        <div class="text-lg font-semibold" id="headerWorkers">14.5M</div>
                    </div>
                    <div class="text-right">
                        <div class="text-warmgray-400">Employers</div>
                        <div class="text-lg font-semibold" id="headerEmployers">99,907</div>
                    </div>
                    <div class="text-right">
                        <div class="text-warmgray-400">Unions</div>
                        <div class="text-lg font-semibold" id="headerUnions">26,665</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- ============================================ -->
    <!-- MAIN CONTENT -->
    <!-- ============================================ -->
    <main class="max-w-7xl mx-auto px-6 py-6">

        <!-- ============================================ -->
        <!-- TERRITORY MODE -->
        <!-- ============================================ -->
        <div id="territoryMode">
            <!-- Union selector bar -->
            <div class="bg-white rounded-lg shadow-sm border border-warmgray-200 mb-6 p-5">
                <div class="flex items-end gap-4">
                    <div class="flex-1">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">National Union</label>
                        <select id="territoryUnion" onchange="onTerritoryUnionChange()"
                            class="w-full px-3 py-2.5 border border-warmgray-300 rounded-md text-sm bg-white font-medium">
                            <option value="">All Unions</option>
                        </select>
                    </div>
                    <div class="w-44">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">State</label>
                        <select id="territoryState" onchange="onTerritoryStateChange()"
                            class="w-full px-3 py-2.5 border border-warmgray-300 rounded-md text-sm bg-white">
                            <option value="">All States</option>
                        </select>
                    </div>
                    <div class="w-52">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Metro Area</label>
                        <select id="territoryMetro" onchange="onTerritoryMetroChange()"
                            class="w-full px-3 py-2.5 border border-warmgray-300 rounded-md text-sm bg-white" disabled>
                            <option value="">Select state first</option>
                        </select>
                    </div>
                    <button onclick="loadTerritoryDashboard()"
                        class="px-6 py-2.5 bg-accent-red text-white font-semibold rounded-md hover:bg-accent-redDark transition-colors whitespace-nowrap">
                        View Territory
                    </button>
                </div>
            </div>

            <!-- Welcome state: quick-start cards -->
            <div id="territoryWelcome">
                <div class="text-center mb-8">
                    <h2 class="headline text-3xl font-bold text-warmgray-900 mb-2">Your Territory at a Glance</h2>
                    <p class="text-warmgray-500 text-lg">Select a union above or click one below to get started</p>
                </div>

                <!-- Quick stats banner -->
                <div class="flex justify-center gap-8 mb-8 text-center">
                    <div>
                        <div class="text-2xl font-bold text-warmgray-900" id="welcomeWorkers">--</div>
                        <div class="text-xs text-warmgray-500 uppercase font-semibold tracking-wide">Workers Covered</div>
                    </div>
                    <div class="w-px bg-warmgray-200"></div>
                    <div>
                        <div class="text-2xl font-bold text-warmgray-900" id="welcomeEmployers">--</div>
                        <div class="text-xs text-warmgray-500 uppercase font-semibold tracking-wide">Employers</div>
                    </div>
                    <div class="w-px bg-warmgray-200"></div>
                    <div>
                        <div class="text-2xl font-bold text-warmgray-900" id="welcomeUnions">--</div>
                        <div class="text-xs text-warmgray-500 uppercase font-semibold tracking-wide">Local Unions</div>
                    </div>
                    <div class="w-px bg-warmgray-200"></div>
                    <div>
                        <div class="text-2xl font-bold text-accent-red" id="welcomeTargets">--</div>
                        <div class="text-xs text-warmgray-500 uppercase font-semibold tracking-wide">Organizing Targets</div>
                    </div>
                </div>

                <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-3 text-center">Top Unions by Membership</div>
                <div id="quickStartGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                    <!-- Populated by loadQuickStartUnions() -->
                    <div class="territory-card animate-pulse"><div class="skeleton h-24"></div></div>
                    <div class="territory-card animate-pulse"><div class="skeleton h-24"></div></div>
                    <div class="territory-card animate-pulse"><div class="skeleton h-24"></div></div>
                    <div class="territory-card animate-pulse"><div class="skeleton h-24"></div></div>
                    <div class="territory-card animate-pulse"><div class="skeleton h-24"></div></div>
                    <div class="territory-card animate-pulse"><div class="skeleton h-24"></div></div>
                    <div class="territory-card animate-pulse"><div class="skeleton h-24"></div></div>
                    <div class="territory-card animate-pulse"><div class="skeleton h-24"></div></div>
                </div>
                <div class="text-center mb-8">
                    <button onclick="openNationalUnionsBrowser()" class="text-sm text-accent-red hover:text-accent-redDark font-medium">
                        Browse all national unions &rarr;
                    </button>
                </div>
            </div>

            <!-- F7 public-sector coverage note -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm text-blue-800 mb-4">
                <strong>Coverage note:</strong> This platform tracks private-sector employers from OLMS Form F-7 filings.
                Public-sector unions (teachers, postal workers, public safety -- ~5.4M members) are tracked
                through separate state PERB systems and are not included in these results.
            </div>

            <!-- Dashboard (hidden until union/state selected) -->
            <div id="territoryDashboard" class="hidden">
                <!-- Filled by Sprint 2 -->
            </div>
        </div>

        <!-- ============================================ -->
        <!-- DEEP DIVE MODE -->
        <!-- ============================================ -->
        <div id="deepDiveMode" class="hidden">
            <!-- Back button -->
            <button onclick="returnFromDeepDive()" class="back-btn mb-5">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                </svg>
                <span id="deepDiveBackLabel">Back to Territory</span>
            </button>
            <!-- Deep dive content (filled by Sprint 3) -->
            <div id="deepDiveContent">
                <div class="text-center py-12 text-warmgray-400">Select an employer to view details</div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- SEARCH MODE (existing content) -->
        <!-- ============================================ -->
        <div id="searchMode" class="hidden">

        <!-- ============================================ -->
        <!-- SEARCH MODE TOGGLE -->
        <!-- ============================================ -->
        <div class="mb-5 flex justify-between items-center">
            <div class="inline-flex gap-1 p-1 bg-warmgray-200 rounded-full">
                <button id="tabEmployers" onclick="setSearchMode('employers')" 
                    class="tab-active px-6 py-2 text-sm font-semibold rounded-full transition-all">
                    Search Employers
                </button>
                <button id="tabUnions" onclick="setSearchMode('unions')" 
                    class="tab-inactive px-6 py-2 text-sm font-semibold rounded-full transition-all hover:text-warmgray-700">
                    Search Unions
                </button>
            </div>
            <div class="flex items-center gap-4">
                <!-- Saved Searches Dropdown -->
                <div class="relative">
                    <button onclick="toggleSavedSearches()" 
                        class="text-sm text-warmgray-500 hover:text-warmgray-700 font-medium flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
                        </svg>
                        Saved Searches
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                    <div id="savedSearchesDropdown" class="hidden absolute right-0 top-full mt-2 w-72 bg-white rounded-lg shadow-lg border border-warmgray-200 z-50">
                        <div class="p-3 border-b border-warmgray-100">
                            <button onclick="saveCurrentSearch()" 
                                class="w-full text-left text-sm text-warmgray-600 hover:text-warmgray-900 flex items-center gap-2 py-1">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                Save current search...
                            </button>
                        </div>
                        <div id="savedSearchesList" class="max-h-64 overflow-y-auto">
                            <div class="p-3 text-sm text-warmgray-400 text-center">No saved searches</div>
                        </div>
                    </div>
                </div>
                <button onclick="openOrganizingScorecard()" 
                    class="text-sm text-green-700 hover:text-green-800 font-medium flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    Organizing Targets
                </button>
                <button onclick="openNationalUnionsBrowser()"
                    class="text-sm text-accent-red hover:text-accent-redDark font-medium flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                    Browse National Unions
                </button>
                <span class="text-warmgray-300">|</span>
                <button onclick="openElectionsModal()"
                    class="text-sm text-blue-700 hover:text-blue-800 font-medium flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                    </svg>
                    Elections
                </button>
                <button onclick="openUnifiedEmployersModal()"
                    class="text-sm text-purple-700 hover:text-purple-800 font-medium flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                    All Employers
                </button>
                <button onclick="openTrendsModal()"
                    class="text-sm text-emerald-700 hover:text-emerald-800 font-medium flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/>
                    </svg>
                    Trends
                </button>
                <button onclick="openPublicSectorModal()"
                    class="text-sm text-orange-700 hover:text-orange-800 font-medium flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"/>
                    </svg>
                    Public Sector
                </button>
                <span class="text-warmgray-300">|</span>
                <button onclick="runDebugCheck()"
                    class="text-sm text-red-600 hover:text-red-700 font-medium">
                    Debug
                </button>
            </div>
        </div>

        <!-- Debug Output -->
        <div id="debugOutput" class="hidden bg-yellow-50 border border-yellow-300 rounded-lg p-4 mb-4 text-sm font-mono"></div>

        <!-- ============================================ -->
        <!-- SEARCH & FILTERS -->
        <!-- ============================================ -->
        <div class="bg-white rounded-lg shadow-sm border border-warmgray-200 mb-5">
            <div class="p-5">
                <!-- Row 1: Main search + Industry typeahead -->
                <div class="flex gap-4 mb-4">
                    <!-- Main search input -->
                    <div class="flex-1 relative">
                        <input type="text" id="mainSearch" 
                            placeholder="Search by name..."
                            class="w-full px-4 py-3 border-2 border-warmgray-300 rounded-lg text-base font-medium placeholder-warmgray-400 focus:border-warmgray-900">
                        <div id="mainSearchTypeahead" class="typeahead-dropdown">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    
                    <!-- Industry typeahead -->
                    <div class="w-80 relative" id="industrySearchContainer">
                        <input type="text" id="industrySearch" 
                            placeholder="Industry, union, or occupation..."
                            class="w-full px-4 py-3 border border-warmgray-300 rounded-lg text-sm placeholder-warmgray-400"
                            autocomplete="off">
                        <div id="industryTypeahead" class="typeahead-dropdown max-h-80 overflow-y-auto custom-scroll">
                            <!-- Populated by JS -->
                        </div>
                        <!-- Tag container for selected industry -->
                        <div id="industryTagContainer" class="mt-2"></div>
                    </div>
                </div>
                
                <!-- Row 2: Geographic cascade + Sector filter -->
                <div class="flex gap-3 items-center">
                    <!-- State -->
                    <div class="w-44">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">State</label>
                        <select id="stateFilter" onchange="onStateChange()" 
                            class="w-full px-3 py-2 border border-warmgray-300 rounded-md text-sm bg-white">
                            <option value="">All States</option>
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    
                    <!-- Metro (depends on state) -->
                    <div class="w-52">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Metro Area</label>
                        <select id="metroFilter" onchange="onMetroChange()" 
                            class="w-full px-3 py-2 border border-warmgray-300 rounded-md text-sm bg-white" disabled>
                            <option value="">Select state first</option>
                        </select>
                    </div>
                    
                    <!-- City (depends on metro or state) -->
                    <div class="w-44">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">City</label>
                        <select id="cityFilter" 
                            class="w-full px-3 py-2 border border-warmgray-300 rounded-md text-sm bg-white" disabled>
                            <option value="">Select metro first</option>
                        </select>
                    </div>
                    
                    <div class="w-px h-10 bg-warmgray-200 mx-2"></div>
                    
                    <!-- Source filter -->
                    <div class="w-40">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Source</label>
                        <select id="sourceFilter"
                            class="w-full px-3 py-2 border border-warmgray-300 rounded-md text-sm bg-white">
                            <option value="">All Sources</option>
                            <option value="F7">F7 (Contract)</option>
                            <option value="NLRB">NLRB (Election)</option>
                            <option value="VR">VR (Vol. Recog.)</option>
                            <option value="MANUAL">Manual (Research)</option>
                        </select>
                    </div>

                    <!-- Sector filter -->
                    <div class="w-40">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Sector</label>
                        <select id="sectorFilter"
                            class="w-full px-3 py-2 border border-warmgray-300 rounded-md text-sm bg-white">
                            <option value="">All Sectors</option>
                            <option value="PRIVATE">Private</option>
                            <option value="PUBLIC_SECTOR">Public (State/Local)</option>
                            <option value="FEDERAL">Federal</option>
                            <option value="RLA">RLA (Rail/Airline)</option>
                        </select>
                    </div>
                    
                    <div class="flex-1"></div>
                    
                    <!-- Search button -->
                    <button onclick="executeSearch()" 
                        class="px-6 py-2 bg-warmgray-900 text-white font-semibold rounded-md hover:bg-warmgray-800 transition-colors">
                        Search
                    </button>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- RESULTS HEADER (Collapsible Stats) -->
        <!-- ============================================ -->
        <div class="bg-warmgray-100 border border-warmgray-200 rounded-lg mb-4">
            <!-- Summary row (always visible) -->
            <div class="px-5 py-3 flex justify-between items-center">
                <div class="flex items-center gap-6">
                    <span class="text-warmgray-600">
                        <strong class="text-warmgray-900" id="resultCount">0</strong> <span id="resultCountLabel">employers</span>
                    </span>
                    <span class="text-warmgray-400">·</span>
                    <span class="text-warmgray-600">
                        <strong class="text-warmgray-900" id="resultWorkers">0</strong> <span id="resultWorkersLabel">workers</span>
                    </span>
                    <span class="text-warmgray-400">·</span>
                    <span class="text-warmgray-600">
                        <strong class="text-warmgray-900" id="resultLocals">0</strong> <span id="resultLocalsLabel">locals</span>
                    </span>
                </div>
                <button onclick="toggleStats()" class="text-sm text-warmgray-500 hover:text-warmgray-700 flex items-center gap-1">
                    <span id="statsToggleText">Show breakdown</span>
                    <svg id="statsToggleIcon" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
            </div>
            
            <!-- Expanded stats (collapsible) -->
            <div id="statsExpanded" class="collapsible-content">
                <div class="px-5 py-4 border-t border-warmgray-200 grid grid-cols-4 gap-6">
                    <div>
                        <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-2">By Sector</div>
                        <div class="space-y-1 text-sm" id="statsBySector">
                            <div class="flex justify-between"><span>Private</span><span class="font-semibold">—</span></div>
                            <div class="flex justify-between"><span>Public</span><span class="font-semibold">—</span></div>
                            <div class="flex justify-between"><span>Federal</span><span class="font-semibold">—</span></div>
                        </div>
                    </div>
                    <div>
                        <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-2">Top Industries</div>
                        <div class="space-y-1 text-sm" id="statsByIndustry">
                            <div class="flex justify-between"><span>Healthcare</span><span class="font-semibold">—</span></div>
                            <div class="flex justify-between"><span>Education</span><span class="font-semibold">—</span></div>
                            <div class="flex justify-between"><span>Manufacturing</span><span class="font-semibold">—</span></div>
                        </div>
                    </div>
                    <div>
                        <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-2">Top Metros</div>
                        <div class="space-y-1 text-sm" id="statsByMetro">
                            <div class="flex justify-between"><span>—</span><span class="font-semibold">—</span></div>
                        </div>
                    </div>
                    <div>
                        <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-2">Top Unions</div>
                        <div class="space-y-1 text-sm" id="statsByUnion">
                            <div class="flex justify-between"><span>—</span><span class="font-semibold">—</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- VIEW TOGGLE -->
        <!-- ============================================ -->
        <div class="flex justify-between items-center mb-4">
            <div class="text-sm text-warmgray-500">
                <span id="resultsCount">0</span> results
                <span id="mappableCount" class="text-warmgray-400 ml-2"></span>
            </div>
            <div class="flex items-center gap-3">
                <button id="shareBtn" onclick="copyShareLink()" 
                    class="text-sm text-warmgray-500 hover:text-warmgray-700 flex items-center gap-1 disabled:opacity-40 disabled:cursor-not-allowed"
                    disabled>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
                    </svg>
                    <span id="shareBtnText">Share</span>
                </button>
                <button id="exportBtn" onclick="exportResults()" 
                    class="text-sm text-warmgray-500 hover:text-warmgray-700 flex items-center gap-1 disabled:opacity-40 disabled:cursor-not-allowed"
                    disabled>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                    </svg>
                    Export CSV
                </button>
                <button id="compareBtn" onclick="openComparison()" 
                    class="text-sm text-warmgray-500 hover:text-warmgray-700 flex items-center gap-1 relative">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    Compare
                    <span id="comparisonBadge" class="hidden absolute -top-1 -right-1 w-4 h-4 bg-accent-red text-white text-xs rounded-full flex items-center justify-center">0</span>
                </button>
                <div class="view-toggle">
                    <button id="listViewBtn" class="active" onclick="setView('list')">
                        <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
                        </svg>
                        List
                    </button>
                    <button id="mapViewBtn" onclick="setView('map')">
                        <svg class="w-4 h-4 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
                        </svg>
                        Map
                    </button>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- MAP VIEW (hidden by default) -->
        <!-- ============================================ -->
        <div id="mapViewContainer" class="hidden mb-5">
            <div class="bg-white rounded-lg shadow-sm border border-warmgray-200 overflow-hidden">
                <div id="fullMapContainer"></div>
            </div>
            <!-- Selected item panel (below map) -->
            <div id="mapSelectionPanel" class="mt-4 hidden">
                <div class="bg-white rounded-lg shadow-sm border border-warmgray-200 p-4">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 id="mapSelectedName" class="font-semibold text-lg text-warmgray-900"></h3>
                            <p id="mapSelectedLocation" class="text-sm text-warmgray-500"></p>
                        </div>
                        <div id="mapSelectedBadges" class="flex gap-2"></div>
                    </div>
                    <div class="mt-3 flex gap-4 text-sm">
                        <div id="mapSelectedStats"></div>
                    </div>
                    <div class="mt-3">
                        <button id="mapViewDetailBtn" class="text-sm font-medium text-accent-red hover:text-accent-redDark">
                            View full details →
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ============================================ -->
        <!-- SPLIT PANE: LIST + DETAIL -->
        <!-- ============================================ -->
        <div id="listViewContainer" class="flex gap-5" style="min-height: 600px;">
            
            <!-- LEFT: Results List -->
            <div class="w-2/5 bg-white rounded-lg shadow-sm border border-warmgray-200 flex flex-col">
                <!-- List header -->
                <div class="px-4 py-3 border-b border-warmgray-200 flex justify-between items-center">
                    <span class="text-sm font-semibold text-warmgray-700">Results</span>
                    <select id="sortBy" class="text-sm border border-warmgray-200 rounded px-2 py-1">
                        <option value="workers">Sort: Workers ↓</option>
                        <option value="name">Sort: Name A-Z</option>
                        <option value="date">Sort: Recent first</option>
                    </select>
                </div>
                
                <!-- List items -->
                <div id="resultsList" class="flex-1 overflow-y-auto custom-scroll">
                    <!-- Empty state -->
                    <div id="emptyState" class="p-8 text-center">
                        <div class="text-warmgray-400 mb-2">
                            <svg class="w-12 h-12 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                        </div>
                        <div id="emptyStateTitle" class="text-warmgray-500 font-medium">Search for employers or unions</div>
                        <div id="emptyStateSubtitle" class="text-warmgray-400 text-sm mt-1">Use the filters above to find organized workplaces</div>
                    </div>
                    
                    <!-- Sample list items (will be generated by JS) -->
                    <div id="listItems" class="hidden">
                        <!-- Populated by JS -->
                    </div>
                </div>
                
                <!-- Pagination -->
                <div id="pagination" class="px-4 py-3 border-t border-warmgray-200 flex justify-between items-center hidden">
                    <button id="prevPage" class="text-sm text-warmgray-500 hover:text-warmgray-700 disabled:opacity-40" disabled>
                        ← Previous
                    </button>
                    <span id="pageInfo" class="text-sm text-warmgray-500">Page 1 of 1</span>
                    <button id="nextPage" class="text-sm text-warmgray-500 hover:text-warmgray-700 disabled:opacity-40" disabled>
                        Next →
                    </button>
                </div>
            </div>
            
            <!-- RIGHT: Detail Panel -->
            <div class="w-3/5 bg-white rounded-lg shadow-sm border border-warmgray-200 flex flex-col">
                
                <!-- Empty state for detail -->
                <div id="detailEmpty" class="flex-1 flex items-center justify-center">
                    <div class="text-center">
                        <div class="text-warmgray-300 mb-3">
                            <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                            </svg>
                        </div>
                        <div id="detailEmptyText" class="text-warmgray-400 font-medium">Select an employer to view details</div>
                    </div>
                </div>
                
                <!-- Detail content (hidden until selection) -->
                <div id="detailContent" class="flex-1 overflow-y-auto custom-scroll hidden">
                    <!-- Header -->
                    <div class="p-5 border-b border-warmgray-200">
                        <div class="flex justify-between items-start">
                            <div>
                                <h2 id="detailName" class="headline text-2xl font-bold text-warmgray-900">Name</h2>
                                <p id="detailLocation" class="text-warmgray-500 mt-1">City, State ZIP</p>
                            </div>
                            <div class="flex items-start gap-3">
                                <div id="detailBadges" class="flex gap-2">
                                    <span class="badge badge-private">Private</span>
                                </div>
                                <button onclick="printReport()" class="text-warmgray-400 hover:text-warmgray-600" title="Print Report">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Review Flags (employer only, unified search) -->
                    <div id="detailFlagSection" class="p-5 border-b border-warmgray-200 hidden">
                        <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-3">Review Flags</div>
                        <div id="existingFlags" class="mb-3"></div>
                        <div class="flex gap-2 items-end">
                            <div class="flex-1">
                                <select id="flagTypeSelect" class="w-full px-2 py-1.5 border border-warmgray-300 rounded text-sm">
                                    <option value="">Flag as...</option>
                                    <option value="ALREADY_UNION">Already Union</option>
                                    <option value="DUPLICATE">Duplicate</option>
                                    <option value="LABOR_ORG_NOT_EMPLOYER">Labor Org Not Employer</option>
                                    <option value="DEFUNCT">Defunct</option>
                                    <option value="DATA_QUALITY">Data Quality</option>
                                    <option value="NEEDS_REVIEW">Needs Review</option>
                                    <option value="VERIFIED_OK">Verified OK</option>
                                </select>
                            </div>
                            <div class="flex-1">
                                <input type="text" id="flagNotesInput" placeholder="Notes (optional)"
                                    class="w-full px-2 py-1.5 border border-warmgray-300 rounded text-sm">
                            </div>
                            <button onclick="submitFlag()" class="px-3 py-1.5 bg-warmgray-900 text-white text-sm rounded hover:bg-warmgray-800">
                                Add
                            </button>
                        </div>
                    </div>
                    
                    <!-- Key metrics (dynamic content) -->
                    <div class="p-5 border-b border-warmgray-200">
                        <div id="detailMetrics" class="grid grid-cols-3 gap-4">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    
                    <!-- Map -->
                    <div class="p-5 border-b border-warmgray-200">
                        <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-3">Location</div>
                        <div id="detailMap" class="bg-warmgray-200 rounded-lg"></div>
                    </div>
                    
                    <!-- Filing/Financial details (dynamic content) -->
                    <div id="detailFilingSection" class="p-5 border-b border-warmgray-200">
                        <!-- Populated by JS -->
                    </div>
                    
                    <!-- Industry/Projections (dynamic content) -->
                    <div id="detailProjections" class="p-5 border-b border-warmgray-200">
                        <!-- Populated by JS -->
                    </div>
                    
                    <!-- Corporate Structure (employer only) -->
                    <div id="detailCorporateSection" class="p-5 border-b border-warmgray-200">
                        <div class="flex justify-between items-center mb-3">
                            <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide">Corporate Family</div>
                            <span id="corporateLoadingBadge" class="text-xs text-warmgray-400 hidden">Loading...</span>
                        </div>
                        <div id="corporateContent">
                            <div class="bg-warmgray-50 border border-dashed border-warmgray-300 rounded-lg p-4 text-center text-sm text-warmgray-400">
                                Searching for related employers...
                            </div>
                        </div>
                    </div>
                    
                    <!-- OSHA Safety Record (employer only) -->
                    <div id="detailOshaSection" class="p-5 border-b border-warmgray-200">
                        <div class="flex justify-between items-center mb-3">
                            <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide">Safety Record (OSHA)</div>
                            <span id="oshaLoadingBadge" class="text-xs text-warmgray-400 hidden">Loading...</span>
                        </div>
                        <div id="oshaContent">
                            <div class="bg-warmgray-50 border border-dashed border-warmgray-300 rounded-lg p-4 text-center text-sm text-warmgray-400">
                                Checking OSHA data...
                            </div>
                        </div>
                    </div>
                    
                    <!-- NLRB Election History (employer only) -->
                    <div id="detailNlrbSection" class="p-5 border-b border-warmgray-200">
                        <div class="flex justify-between items-center mb-3">
                            <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide">NLRB History</div>
                            <span id="nlrbLoadingBadge" class="text-xs text-warmgray-400 hidden">Loading...</span>
                        </div>
                        <div id="nlrbContent">
                            <div class="bg-warmgray-50 border border-dashed border-warmgray-300 rounded-lg p-4 text-center text-sm text-warmgray-400">
                                Checking NLRB records...
                            </div>
                        </div>
                    </div>

                    <!-- Source Records (employer only, unified search) -->
                    <div id="detailSourceSection" class="p-5 border-b border-warmgray-200 hidden">
                        <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-3">Source Records</div>
                        <div id="sourceRecordsContent"></div>
                    </div>

                    <!-- Employers Covered (union only) -->
                    <div id="detailEmployersSection" class="p-5 border-b border-warmgray-200 hidden">
                        <!-- Populated by JS -->
                    </div>
                    
                    <!-- Financial Trends Chart (union only) -->
                    <div id="detailTrendsSection" class="p-5 border-b border-warmgray-200 hidden">
                        <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-3">Membership & Financial Trends</div>
                        <canvas id="trendsChart" height="180"></canvas>
                    </div>
                    
                    <!-- Financial Details (union only) -->
                    <div id="detailFinancialsSection" class="p-5 border-b border-warmgray-200 hidden">
                        <!-- Populated by JS -->
                    </div>
                    
                    <!-- Sister Locals (union only) -->
                    <div id="detailSisterLocalsSection" class="p-5 border-b border-warmgray-200 hidden">
                        <!-- Populated by JS -->
                    </div>
                    
                    <!-- Geographic Distribution (union only) -->
                    <div id="detailGeoSection" class="p-5 border-b border-warmgray-200 hidden">
                        <!-- Populated by JS -->
                    </div>
                    
                    <!-- News Mentions -->
                    <div id="detailNewsSection" class="p-5 border-b border-warmgray-200">
                        <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-3">Recent News</div>
                        <div class="bg-warmgray-50 border border-dashed border-warmgray-300 rounded-lg p-4 text-center text-sm text-warmgray-400">
                            News monitoring coming soon
                        </div>
                    </div>
                    
                    <!-- Action Button -->
                    <div id="detailActionSection" class="p-5">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>
        </div><!-- end #searchMode -->
    </main>

    <!-- ============================================ -->
    <!-- FIND SIMILAR MODAL -->
    <!-- ============================================ -->
    <div id="findSimilarModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[85vh] overflow-hidden flex flex-col">
            <!-- Modal header -->
            <div class="px-6 py-4 border-b border-warmgray-200 flex justify-between items-center flex-shrink-0">
                <div>
                    <h3 class="headline text-xl font-bold text-warmgray-900">Find Similar Employers</h3>
                    <p class="text-sm text-warmgray-500 mt-0.5">Non-union employers from OSHA data with safety violations</p>
                </div>
                <button onclick="closeFindSimilar()" class="text-warmgray-400 hover:text-warmgray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Modal content - Form -->
            <div id="findSimilarForm" class="p-6 overflow-y-auto">
                <!-- Source employer reference -->
                <div class="bg-warmgray-100 rounded-lg p-4 mb-5">
                    <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Based on</div>
                    <div class="font-semibold text-warmgray-900" id="similarSourceName">Kaiser Permanente</div>
                    <div class="text-sm text-warmgray-500" id="similarSourceDetails">Healthcare · Oakland, CA · 58,420 workers</div>
                </div>
                
                <!-- Match criteria toggles -->
                <div class="mb-5">
                    <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-3">Match Criteria</div>
                    <div class="space-y-3">
                        <label class="flex items-center gap-3">
                            <input type="checkbox" id="matchIndustry" checked class="rounded border-warmgray-300 text-warmgray-900 focus:ring-warmgray-500">
                            <span class="text-sm">Same industry (<span id="matchIndustryLabel">Healthcare - NAICS 62</span>)</span>
                        </label>
                        <label class="flex items-center gap-3">
                            <input type="checkbox" id="matchNonUnion" checked class="rounded border-warmgray-300 text-warmgray-900 focus:ring-warmgray-500">
                            <span class="text-sm font-medium text-accent-red">Non-union only (from OSHA data)</span>
                        </label>
                    </div>
                </div>
                
                <!-- Geography override -->
                <div class="mb-5">
                    <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-3">Geography</div>
                    <div class="flex gap-3">
                        <select id="similarGeoLevel" class="px-3 py-2 border border-warmgray-300 rounded-md text-sm flex-1">
                            <option value="city">Same City</option>
                            <option value="state" selected>Same State</option>
                            <option value="radius">Within Radius</option>
                        </select>
                        <input type="number" id="similarRadius" value="50" min="10" max="200"
                            class="px-3 py-2 border border-warmgray-300 rounded-md text-sm w-24 hidden" disabled>
                        <span id="similarRadiusLabel" class="text-sm text-warmgray-500 self-center hidden">miles</span>
                    </div>
                </div>
                
                <!-- Size filter -->
                <div class="mb-6">
                    <div class="text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-3">Minimum Employees</div>
                    <select id="similarMinSize" class="px-3 py-2 border border-warmgray-300 rounded-md text-sm w-full">
                        <option value="0">Any size</option>
                        <option value="10" selected>10+ employees</option>
                        <option value="50">50+ employees</option>
                        <option value="100">100+ employees</option>
                        <option value="250">250+ employees</option>
                    </select>
                </div>
                
                <!-- Action buttons -->
                <div class="flex gap-3">
                    <button onclick="executeFindSimilar()" id="findSimilarBtn"
                        class="flex-1 py-3 bg-warmgray-900 text-white font-semibold rounded-lg hover:bg-warmgray-800 transition-colors">
                        Find Similar Employers
                    </button>
                    <button onclick="closeFindSimilar()" 
                        class="px-6 py-3 border border-warmgray-300 text-warmgray-700 font-semibold rounded-lg hover:bg-warmgray-50 transition-colors">
                        Cancel
                    </button>
                </div>
            </div>
            
            <!-- Modal content - Results (hidden initially) -->
            <div id="findSimilarResults" class="hidden flex-1 overflow-hidden flex flex-col">
                <!-- Results header -->
                <div class="px-6 py-3 bg-warmgray-50 border-b border-warmgray-200 flex justify-between items-center flex-shrink-0">
                    <div>
                        <span class="font-semibold text-warmgray-900" id="similarResultsCount">47 potential targets found</span>
                        <span class="text-sm text-warmgray-500 ml-2" id="similarResultsSource">from OSHA data</span>
                    </div>
                    <button onclick="showFindSimilarForm()" class="text-sm text-accent-red hover:underline">
                        ← Modify Search
                    </button>
                </div>
                
                <!-- Results list -->
                <div class="overflow-y-auto flex-1 p-4" id="similarResultsList">
                    <!-- Results populated by JS -->
                </div>
            </div>
            
            <!-- Loading state -->
            <div id="findSimilarLoading" class="hidden p-12 text-center">
                <div class="inline-block w-8 h-8 border-4 border-warmgray-300 border-t-warmgray-900 rounded-full animate-spin mb-4"></div>
                <p class="text-warmgray-600">Searching OSHA establishments...</p>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- NATIONAL UNION DASHBOARD MODAL -->
    <!-- ============================================ -->
    <div id="nationalDashboardModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col m-4">
            <!-- Modal header -->
            <div class="px-6 py-4 border-b border-warmgray-200 flex justify-between items-center flex-shrink-0">
                <div>
                    <h2 id="dashboardTitle" class="headline text-2xl font-bold text-warmgray-900">SEIU</h2>
                    <p class="text-sm text-warmgray-500">National Union Dashboard</p>
                </div>
                <button onclick="closeNationalDashboard()" class="text-warmgray-400 hover:text-warmgray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Loading state -->
            <div id="dashboardLoading" class="p-12 text-center">
                <div class="inline-block w-8 h-8 border-4 border-warmgray-300 border-t-warmgray-900 rounded-full animate-spin mb-4"></div>
                <p class="text-warmgray-600">Loading dashboard data...</p>
            </div>
            
            <!-- Dashboard content -->
            <div id="dashboardContent" class="hidden flex-1 overflow-y-auto p-6">
                <!-- Summary cards -->
                <div class="grid grid-cols-5 gap-4 mb-6">
                    <div class="bg-warmgray-100 rounded-lg p-4 text-center">
                        <div id="dashLocalCount" class="text-3xl font-bold text-warmgray-900">0</div>
                        <div class="text-xs text-warmgray-500 uppercase tracking-wide">Locals</div>
                    </div>
                    <div class="bg-warmgray-100 rounded-lg p-4 text-center">
                        <div id="dashMemberCount" class="text-3xl font-bold text-accent-red">0</div>
                        <div class="text-xs text-warmgray-500 uppercase tracking-wide">Members</div>
                    </div>
                    <div class="bg-warmgray-100 rounded-lg p-4 text-center">
                        <div id="dashEmployerCount" class="text-3xl font-bold text-warmgray-900">0</div>
                        <div class="text-xs text-warmgray-500 uppercase tracking-wide">Employers</div>
                    </div>
                    <div class="bg-warmgray-100 rounded-lg p-4 text-center">
                        <div id="dashWorkerCount" class="text-3xl font-bold text-warmgray-900">0</div>
                        <div class="text-xs text-warmgray-500 uppercase tracking-wide">Workers Covered</div>
                    </div>
                    <div class="bg-warmgray-100 rounded-lg p-4 text-center">
                        <div id="dashStateCount" class="text-3xl font-bold text-warmgray-900">0</div>
                        <div class="text-xs text-warmgray-500 uppercase tracking-wide">States</div>
                    </div>
                </div>
                
                <!-- Trends badges -->
                <div id="dashTrends" class="mb-6 flex gap-4 hidden">
                    <span id="dashMemberTrend" class="px-3 py-1 rounded-full text-sm font-medium"></span>
                    <span id="dashAssetTrend" class="px-3 py-1 rounded-full text-sm font-medium"></span>
                </div>
                
                <!-- Two column layout -->
                <div class="grid grid-cols-2 gap-6">
                    <!-- Left column -->
                    <div class="space-y-6">
                        <!-- Financial trends chart -->
                        <div class="bg-white border border-warmgray-200 rounded-lg p-4">
                            <h3 class="text-sm font-semibold text-warmgray-700 uppercase tracking-wide mb-3">Membership Trend</h3>
                            <canvas id="dashTrendsChart" height="200"></canvas>
                        </div>
                        
                        <!-- Top locals -->
                        <div class="bg-white border border-warmgray-200 rounded-lg p-4">
                            <h3 class="text-sm font-semibold text-warmgray-700 uppercase tracking-wide mb-3">Largest Locals</h3>
                            <div id="dashTopLocals" class="space-y-2 max-h-64 overflow-y-auto">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right column -->
                    <div class="space-y-6">
                        <!-- Geographic distribution -->
                        <div class="bg-white border border-warmgray-200 rounded-lg p-4">
                            <h3 class="text-sm font-semibold text-warmgray-700 uppercase tracking-wide mb-3">Geographic Distribution</h3>
                            <div id="dashGeoDistribution" class="space-y-2 max-h-48 overflow-y-auto">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        
                        <!-- Industry breakdown -->
                        <div class="bg-white border border-warmgray-200 rounded-lg p-4">
                            <h3 class="text-sm font-semibold text-warmgray-700 uppercase tracking-wide mb-3">Industry Breakdown</h3>
                            <div id="dashIndustries" class="flex flex-wrap gap-2">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        
                        <!-- Top employers -->
                        <div class="bg-white border border-warmgray-200 rounded-lg p-4">
                            <h3 class="text-sm font-semibold text-warmgray-700 uppercase tracking-wide mb-3">Largest Employers</h3>
                            <div id="dashTopEmployers" class="space-y-2 max-h-48 overflow-y-auto">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="px-6 py-4 border-t border-warmgray-200 flex justify-between items-center flex-shrink-0">
                <div id="dashSectors" class="flex gap-2">
                    <!-- Sector badges -->
                </div>
                <div class="flex gap-3">
                    <button id="searchLocalsBtn" onclick="searchLocalsForCurrentAffiliation()"
                        class="px-4 py-2 bg-warmgray-100 text-warmgray-700 font-semibold rounded-lg hover:bg-warmgray-200 transition-colors flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        Search All Locals
                    </button>
                    <button onclick="closeNationalDashboard()"
                        class="px-6 py-2 bg-warmgray-900 text-white font-semibold rounded-lg hover:bg-warmgray-800 transition-colors">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- NATIONAL UNIONS BROWSER MODAL -->
    <!-- ============================================ -->
    <div id="nationalBrowserModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[80vh] overflow-hidden flex flex-col m-4">
            <!-- Modal header -->
            <div class="px-6 py-4 border-b border-warmgray-200 flex justify-between items-center flex-shrink-0">
                <div>
                    <h2 class="headline text-xl font-bold text-warmgray-900">National Unions</h2>
                    <p class="text-sm text-warmgray-500">Select a union to view its dashboard</p>
                </div>
                <button onclick="closeNationalBrowser()" class="text-warmgray-400 hover:text-warmgray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Loading state -->
            <div id="browserLoading" class="p-12 text-center">
                <div class="inline-block w-8 h-8 border-4 border-warmgray-300 border-t-warmgray-900 rounded-full animate-spin mb-4"></div>
                <p class="text-warmgray-600">Loading national unions...</p>
            </div>
            
            <!-- Content -->
            <div id="browserContent" class="hidden flex-1 overflow-y-auto p-4">
                <div id="browserList" class="grid grid-cols-2 gap-3">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- COMPARISON MODAL -->
    <!-- ============================================ -->
    <div id="comparisonModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col m-4">
            <!-- Modal header -->
            <div class="px-6 py-4 border-b border-warmgray-200 flex justify-between items-center flex-shrink-0">
                <div>
                    <h2 class="headline text-xl font-bold text-warmgray-900">Compare</h2>
                    <p id="comparisonSubtitle" class="text-sm text-warmgray-500">Side-by-side comparison</p>
                </div>
                <button onclick="closeComparison()" class="text-warmgray-400 hover:text-warmgray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Comparison content -->
            <div id="comparisonContent" class="flex-1 overflow-y-auto p-6">
                <div class="grid grid-cols-2 gap-6">
                    <!-- Left item -->
                    <div id="compareLeft" class="border border-warmgray-200 rounded-lg p-4">
                        <div class="text-center text-warmgray-400 py-8">
                            <p>Select first item to compare</p>
                        </div>
                    </div>
                    <!-- Right item -->
                    <div id="compareRight" class="border border-warmgray-200 rounded-lg p-4">
                        <div class="text-center text-warmgray-400 py-8">
                            <p>Select second item to compare</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="px-6 py-4 border-t border-warmgray-200 flex justify-between items-center flex-shrink-0">
                <button onclick="clearComparison()" class="text-sm text-warmgray-500 hover:text-warmgray-700">
                    Clear comparison
                </button>
                <button onclick="closeComparison()" 
                    class="px-6 py-2 bg-warmgray-900 text-white font-semibold rounded-lg hover:bg-warmgray-800 transition-colors">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- ORGANIZING SCORECARD MODAL -->
    <!-- ============================================ -->
    <div id="scorecardModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col m-4">
            <!-- Modal header -->
            <div class="px-6 py-4 border-b border-warmgray-200 flex justify-between items-center flex-shrink-0 bg-gradient-to-r from-green-50 to-white">
                <div>
                    <h2 class="headline text-xl font-bold text-warmgray-900 flex items-center gap-2">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        Organizing Scorecard
                    </h2>
                    <p class="text-sm text-warmgray-500">Non-union establishments scored by organizing potential</p>
                </div>
                <button onclick="closeOrganizingScorecard()" class="text-warmgray-400 hover:text-warmgray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Filters Row 1: Data Source & Union Preset -->
            <div class="px-6 py-3 border-b border-warmgray-200 bg-gradient-to-r from-blue-50 to-warmgray-50">
                <div class="flex gap-4 items-end flex-wrap">
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Union Preset</label>
                        <select id="scorecardUnionPreset" onchange="loadUnionPreset(this.value)"
                            class="px-3 py-2 border border-blue-300 rounded-lg text-sm bg-white min-w-[200px]">
                            <option value="">Select a Union...</option>
                            <option value="AFSCME_NY">AFSCME New York</option>
                            <option value="SEIU_NY">SEIU New York</option>
                            <option value="UAW_NY">UAW New York</option>
                            <option value="CWA_NY">CWA New York</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Data Source</label>
                        <select id="scorecardDataSource" onchange="updateScorecardFilters()"
                            class="px-3 py-2 border border-blue-300 rounded-lg text-sm bg-white min-w-[180px]">
                            <option value="osha">OSHA Establishments</option>
                            <optgroup label="Mergent Sectors (NY)">
                                <option value="sector:education">Education</option>
                                <option value="sector:social_services">Social Services</option>
                                <option value="sector:building_services">Building Services</option>
                                <option value="sector:civic_organizations">Civic Organizations</option>
                                <option value="sector:healthcare_ambulatory">Healthcare - Ambulatory</option>
                                <option value="sector:healthcare_hospitals">Healthcare - Hospitals</option>
                                <option value="sector:healthcare_nursing">Healthcare - Nursing</option>
                                <option value="sector:broadcasting">Broadcasting</option>
                                <option value="sector:publishing">Publishing</option>
                                <option value="sector:professional">Professional Services</option>
                                <option value="sector:government">Government</option>
                                <option value="sector:museums">Museums</option>
                                <option value="sector:information">Information</option>
                                <option value="sector:waste_mgmt">Waste Management</option>
                                <option value="sector:repair_services">Repair Services</option>
                                <option value="sector:transit">Transit</option>
                                <option value="sector:utilities">Utilities</option>
                                <option value="sector:hospitality">Hospitality</option>
                                <option value="sector:food_service">Food Service</option>
                                <option value="sector:arts_entertainment">Arts & Entertainment</option>
                                <option value="sector:other">Other Industries</option>
                            </optgroup>
                        </select>
                    </div>
                    <div id="sectorStatsDisplay" class="hidden text-sm text-warmgray-600 bg-white px-3 py-2 rounded-lg border border-warmgray-200">
                        <!-- Populated by JS when sector selected -->
                    </div>
                </div>
            </div>

            <!-- Filters Row 2: Search Criteria -->
            <div class="px-6 py-4 border-b border-warmgray-200 bg-warmgray-50">
                <div class="flex gap-4 items-end flex-wrap">
                    <div id="scorecardStateContainer">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">State</label>
                        <select id="scorecardState" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                            <option value="">All States</option>
                        </select>
                    </div>
                    <div id="scorecardIndustryContainer">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Industry</label>
                        <select id="scorecardIndustry" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                            <option value="">All Industries</option>
                            <option value="11">Agriculture</option>
                            <option value="21">Mining</option>
                            <option value="22">Utilities</option>
                            <option value="23">Construction</option>
                            <option value="31">Manufacturing</option>
                            <option value="42">Wholesale Trade</option>
                            <option value="44">Retail Trade</option>
                            <option value="48">Transportation</option>
                            <option value="51">Information</option>
                            <option value="52">Finance</option>
                            <option value="53">Real Estate</option>
                            <option value="54">Professional Services</option>
                            <option value="56">Admin & Waste Services</option>
                            <option value="61">Education</option>
                            <option value="62">Healthcare</option>
                            <option value="71">Arts & Entertainment</option>
                            <option value="72">Accommodation & Food</option>
                            <option value="81">Other Services</option>
                        </select>
                    </div>
                    <div id="scorecardTierContainer" class="hidden">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Priority Tier</label>
                        <select id="scorecardTier" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                            <option value="">All Tiers</option>
                            <option value="TOP">TOP (40+)</option>
                            <option value="HIGH">HIGH (30-39)</option>
                            <option value="MEDIUM">MEDIUM (20-29)</option>
                            <option value="LOW">LOW (&lt;20)</option>
                        </select>
                    </div>
                    <div id="scorecardCityContainer" class="hidden">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">City</label>
                        <select id="scorecardCity" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm min-w-[150px]">
                            <option value="">All Cities</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Min Employees</label>
                        <input type="number" id="scorecardMinEmp" value="25" min="1" max="10000"
                            class="w-24 px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Max Employees</label>
                        <input type="number" id="scorecardMaxEmp" value="5000" min="1" max="100000"
                            class="w-24 px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Min Score</label>
                        <input type="number" id="scorecardMinScore" value="20" min="0" max="100"
                            class="w-20 px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                    </div>
                    <div id="scorecardContractsContainer">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Contracts</label>
                        <select id="scorecardContracts" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                            <option value="">All</option>
                            <option value="true">Has Contracts</option>
                            <option value="false">No Contracts</option>
                        </select>
                    </div>
                    <button onclick="loadScorecardResults()"
                        class="px-6 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors">
                        Search
                    </button>
                </div>
            </div>
            
            <!-- Loading state -->
            <div id="scorecardLoading" class="hidden p-12 text-center">
                <div class="inline-block w-8 h-8 border-4 border-warmgray-300 border-t-green-600 rounded-full animate-spin mb-4"></div>
                <p class="text-warmgray-600">Scoring establishments...</p>
            </div>
            
            <!-- Results -->
            <div id="scorecardContent" class="flex-1 overflow-hidden flex">
                <!-- Results list -->
                <div class="w-1/2 border-r border-warmgray-200 overflow-y-auto">
                    <div id="scorecardResultsInfo" class="px-4 py-2 bg-warmgray-50 text-sm text-warmgray-500 border-b border-warmgray-200">
                        Click "Search" to find organizing targets
                    </div>
                    <div id="scorecardResults" class="divide-y divide-warmgray-100">
                        <!-- Populated by JS -->
                    </div>
                </div>
                
                <!-- Detail panel -->
                <div class="w-1/2 overflow-y-auto">
                    <div id="scorecardDetailEmpty" class="p-8 text-center text-warmgray-400">
                        <svg class="w-12 h-12 mx-auto mb-3 text-warmgray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        <p>Select an establishment to view score breakdown</p>
                    </div>
                    <div id="scorecardDetail" class="hidden p-4">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
            
            <!-- Legend -->
            <div class="px-6 py-3 border-t border-warmgray-200 bg-warmgray-50 text-xs text-warmgray-500">
                <div class="flex items-center gap-4 flex-wrap">
                    <span class="font-semibold text-warmgray-700">Score Components:</span>
                    <span><span class="inline-block w-3 h-3 rounded bg-red-500 mr-1"></span> Safety (0-25)</span>
                    <span><span class="inline-block w-3 h-3 rounded bg-blue-500 mr-1"></span> Industry (0-15)</span>
                    <span><span class="inline-block w-3 h-3 rounded bg-purple-500 mr-1"></span> Geographic (0-15)</span>
                    <span><span class="inline-block w-3 h-3 rounded bg-yellow-500 mr-1"></span> Size (0-15)</span>
                    <span><span class="inline-block w-3 h-3 rounded bg-green-500 mr-1"></span> NLRB (0-15)</span>
                    <span><span class="inline-block w-3 h-3 rounded bg-orange-500 mr-1"></span> Govt Contracts (0-15)</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- ANALYTICS DASHBOARD MODAL -->
    <!-- ============================================ -->
    <div id="analyticsDashboardModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 overflow-y-auto">
        <div class="bg-cream rounded-xl shadow-2xl w-full max-w-7xl min-h-[90vh] m-4">
            <!-- Modal header -->
            <div class="sticky top-0 z-10 bg-warmgray-900 text-white rounded-t-xl px-6 py-4 flex justify-between items-center">
                <div>
                    <h2 class="headline text-xl font-bold flex items-center gap-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        Analytics Dashboard
                    </h2>
                    <p class="text-warmgray-400 text-sm">Platform-wide metrics and trends</p>
                </div>
                <button onclick="closeAnalyticsDashboard()" class="text-warmgray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Loading state -->
            <div id="analyticsDashboardLoading" class="p-12 text-center">
                <div class="inline-block w-10 h-10 border-4 border-warmgray-300 border-t-warmgray-900 rounded-full animate-spin mb-4"></div>
                <p class="text-warmgray-600">Loading dashboard data...</p>
            </div>

            <!-- Dashboard content -->
            <div id="analyticsDashboardContent" class="hidden p-6">
                <!-- Summary Cards Row -->
                <div class="grid grid-cols-6 gap-4 mb-6">
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <div class="text-xs font-semibold text-warmgray-500 uppercase">Total Unions</div>
                        <div id="dashUnions" class="text-2xl font-bold text-warmgray-900 mt-1">-</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <div class="text-xs font-semibold text-warmgray-500 uppercase">Members</div>
                        <div id="dashMembers" class="text-2xl font-bold text-accent-red mt-1">-</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <div class="text-xs font-semibold text-warmgray-500 uppercase">Employers</div>
                        <div id="dashEmployers" class="text-2xl font-bold text-warmgray-900 mt-1">-</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <div class="text-xs font-semibold text-warmgray-500 uppercase">Workers Covered</div>
                        <div id="dashWorkers" class="text-2xl font-bold text-warmgray-900 mt-1">-</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <div class="text-xs font-semibold text-warmgray-500 uppercase">OSHA Establishments</div>
                        <div id="dashOsha" class="text-2xl font-bold text-warmgray-900 mt-1">-</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <div class="text-xs font-semibold text-warmgray-500 uppercase">NLRB Cases (1yr)</div>
                        <div id="dashNlrb" class="text-2xl font-bold text-warmgray-900 mt-1">-</div>
                        <div id="dashNlrbWins" class="text-xs text-green-600 mt-1"></div>
                    </div>
                </div>
                
                <!-- Charts Row -->
                <div class="grid grid-cols-2 gap-6 mb-6">
                    <!-- Membership Trends Chart -->
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <h3 class="text-sm font-semibold text-warmgray-700 uppercase tracking-wide mb-4">Membership Trends</h3>
                        <div class="h-64">
                            <canvas id="membershipChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- NLRB Elections Chart -->
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <h3 class="text-sm font-semibold text-warmgray-700 uppercase tracking-wide mb-4">NLRB Elections by Year</h3>
                        <div class="h-64">
                            <canvas id="nlrbChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Second Charts Row -->
                <div class="grid grid-cols-2 gap-6 mb-6">
                    <!-- F-7 Filings Chart -->
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <h3 class="text-sm font-semibold text-warmgray-700 uppercase tracking-wide mb-4">Bargaining Notices (F-7 Filings)</h3>
                        <div class="h-64">
                            <canvas id="f7Chart"></canvas>
                        </div>
                    </div>
                    
                    <!-- OSHA Violations Chart -->
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <h3 class="text-sm font-semibold text-warmgray-700 uppercase tracking-wide mb-4">OSHA Violations by Year</h3>
                        <div class="h-64">
                            <canvas id="oshaChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Bottom Section: NLRB Activity + Growth Tables -->
                <div class="grid grid-cols-3 gap-6 mb-6">
                    <!-- Recent NLRB Elections -->
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <h3 class="text-sm font-semibold text-warmgray-700 uppercase tracking-wide mb-4">Recent NLRB Elections</h3>
                        <div id="recentNlrb" class="space-y-2 max-h-72 overflow-y-auto">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    
                    <!-- Top Growing Unions -->
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <h3 class="text-sm font-semibold text-warmgray-700 uppercase tracking-wide mb-4 flex items-center gap-2">
                            <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                            Growing Unions (YoY)
                        </h3>
                        <div id="growingUnions" class="space-y-2 max-h-72 overflow-y-auto">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    
                    <!-- Top Declining Unions -->
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <h3 class="text-sm font-semibold text-warmgray-700 uppercase tracking-wide mb-4 flex items-center gap-2">
                            <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                            Declining Unions (YoY)
                        </h3>
                        <div id="decliningUnions" class="space-y-2 max-h-72 overflow-y-auto">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
                
                <!-- Geographic + Top Lists -->
                <div class="grid grid-cols-3 gap-6">
                    <!-- Top States by Union Membership -->
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <h3 class="text-sm font-semibold text-warmgray-700 uppercase tracking-wide mb-4">Top States by Membership</h3>
                        <div id="topStates" class="space-y-2 max-h-64 overflow-y-auto">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    
                    <!-- Top Affiliations -->
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <h3 class="text-sm font-semibold text-warmgray-700 uppercase tracking-wide mb-4">Top National Unions</h3>
                        <div id="topAffiliations" class="space-y-2 max-h-64 overflow-y-auto">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    
                    <!-- Top Industries -->
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <h3 class="text-sm font-semibold text-warmgray-700 uppercase tracking-wide mb-4">Top Industries</h3>
                        <div id="topIndustries" class="space-y-2 max-h-64 overflow-y-auto">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- CORPORATE FAMILY MODAL -->
    <!-- ============================================ -->
    <div id="corporateFamilyModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 overflow-y-auto">
        <div class="bg-cream rounded-xl shadow-2xl w-full max-w-6xl min-h-[85vh] m-4">
            <!-- Modal header -->
            <div class="sticky top-0 z-10 bg-gradient-to-r from-warmgray-800 to-warmgray-700 text-white rounded-t-xl px-6 py-4 flex justify-between items-center">
                <div>
                    <h2 class="headline text-xl font-bold flex items-center gap-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                        <span id="corporateFamilyTitle">Corporate Family</span>
                    </h2>
                    <p class="text-warmgray-300 text-sm" id="corporateFamilySubtitle">Related employers and locations</p>
                </div>
                <button onclick="closeCorporateFamily()" class="text-warmgray-300 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Loading state -->
            <div id="corporateFamilyLoading" class="p-12 text-center">
                <div class="inline-block w-10 h-10 border-4 border-warmgray-300 border-t-warmgray-900 rounded-full animate-spin mb-4"></div>
                <p class="text-warmgray-600">Analyzing corporate relationships...</p>
            </div>
            
            <!-- Content -->
            <div id="corporateFamilyContent" class="hidden p-6">
                <!-- Summary Cards -->
                <div class="grid grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <div class="text-xs font-semibold text-warmgray-500 uppercase">Total Locations</div>
                        <div id="cfLocations" class="text-3xl font-bold text-warmgray-900 mt-1">—</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <div class="text-xs font-semibold text-warmgray-500 uppercase">Total Workers</div>
                        <div id="cfWorkers" class="text-3xl font-bold text-accent-red mt-1">—</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <div class="text-xs font-semibold text-warmgray-500 uppercase">States</div>
                        <div id="cfStates" class="text-3xl font-bold text-warmgray-900 mt-1">—</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                        <div class="text-xs font-semibold text-warmgray-500 uppercase">Unions</div>
                        <div id="cfUnions" class="text-3xl font-bold text-warmgray-900 mt-1">—</div>
                    </div>
                </div>
                
                <!-- Main content grid -->
                <div class="grid grid-cols-3 gap-6">
                    <!-- Left: Location list -->
                    <div class="col-span-2">
                        <div class="bg-white rounded-lg shadow-sm border border-warmgray-200">
                            <div class="px-4 py-3 border-b border-warmgray-200 flex justify-between items-center">
                                <h3 class="text-sm font-semibold text-warmgray-700 uppercase">All Locations</h3>
                                <span id="cfLocationCount" class="text-xs text-warmgray-500"></span>
                            </div>
                            <div id="cfLocationList" class="divide-y divide-warmgray-100 max-h-96 overflow-y-auto">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        
                        <!-- Map -->
                        <div class="mt-4 bg-white rounded-lg shadow-sm border border-warmgray-200 p-4">
                            <h3 class="text-sm font-semibold text-warmgray-700 uppercase mb-3">Location Map</h3>
                            <div id="corporateFamilyMap" class="h-64 rounded-lg bg-warmgray-100"></div>
                        </div>
                    </div>
                    
                    <!-- Right: Breakdowns -->
                    <div class="space-y-4">
                        <!-- By State -->
                        <div class="bg-white rounded-lg shadow-sm border border-warmgray-200 p-4">
                            <h3 class="text-sm font-semibold text-warmgray-700 uppercase mb-3">By State</h3>
                            <div id="cfByState" class="space-y-2 max-h-48 overflow-y-auto">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        
                        <!-- By Union -->
                        <div class="bg-white rounded-lg shadow-sm border border-warmgray-200 p-4">
                            <h3 class="text-sm font-semibold text-warmgray-700 uppercase mb-3">By Union</h3>
                            <div id="cfByUnion" class="space-y-2 max-h-48 overflow-y-auto">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                        
                        <!-- Matching Info -->
                        <div class="bg-warmgray-100 rounded-lg p-4">
                            <h3 class="text-xs font-semibold text-warmgray-500 uppercase mb-2">Matching Method</h3>
                            <p class="text-sm text-warmgray-600">
                                <span class="font-medium">Root Name:</span> 
                                <span id="cfRootName" class="font-mono text-xs bg-warmgray-200 px-2 py-0.5 rounded">—</span>
                            </p>
                            <p class="text-xs text-warmgray-400 mt-2">
                                Employers matched by normalized company name. May include subsidiaries, divisions, and multiple locations.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- UNIFIED EMPLOYERS MODAL -->
    <!-- ============================================ -->
    <div id="unifiedEmployersModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col m-4">
            <!-- Modal header -->
            <div class="px-6 py-4 border-b border-warmgray-200 flex justify-between items-center flex-shrink-0 bg-gradient-to-r from-purple-50 to-white">
                <div>
                    <h2 class="headline text-xl font-bold text-warmgray-900 flex items-center gap-2">
                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                        All Employers
                    </h2>
                    <p class="text-sm text-warmgray-500">Unified employer database from all sources</p>
                </div>
                <button onclick="closeUnifiedEmployersModal()" class="text-warmgray-400 hover:text-warmgray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- Filters -->
            <div class="px-6 py-4 border-b border-warmgray-200 bg-warmgray-50">
                <div class="flex gap-4 items-end flex-wrap">
                    <div class="flex-1 min-w-48">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Name Search</label>
                        <input type="text" id="unifiedNameSearch" placeholder="Search by employer name..."
                            class="w-full px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">State</label>
                        <select id="unifiedState" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                            <option value="">All States</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Source</label>
                        <select id="unifiedSource" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                            <option value="">All Sources</option>
                            <option value="F7">F-7 (Private Sector CBAs)</option>
                            <option value="NLRB">NLRB (Election Participants)</option>
                            <option value="VR">VR (Voluntary Recognition)</option>
                            <option value="PUBLIC">Public Sector</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Has Union</label>
                        <select id="unifiedHasUnion" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                            <option value="">Any</option>
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Has OSHA</label>
                        <select id="unifiedHasOsha" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                            <option value="">Any</option>
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                        </select>
                    </div>
                    <button onclick="loadUnifiedEmployers()"
                        class="px-6 py-2 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition-colors">
                        Search
                    </button>
                </div>
            </div>

            <!-- Loading state -->
            <div id="unifiedLoading" class="hidden p-12 text-center">
                <div class="inline-block w-8 h-8 border-4 border-warmgray-300 border-t-purple-600 rounded-full animate-spin mb-4"></div>
                <p class="text-warmgray-600">Loading employers...</p>
            </div>

            <!-- Results -->
            <div id="unifiedContent" class="flex-1 overflow-hidden flex">
                <!-- Results list -->
                <div class="w-1/2 border-r border-warmgray-200 overflow-y-auto">
                    <div id="unifiedResultsInfo" class="px-4 py-2 bg-warmgray-50 text-sm text-warmgray-500 border-b border-warmgray-200">
                        Click "Search" to find employers
                    </div>
                    <div id="unifiedResults" class="divide-y divide-warmgray-100">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Detail panel -->
                <div class="w-1/2 overflow-y-auto">
                    <div id="unifiedDetailEmpty" class="p-8 text-center text-warmgray-400">
                        <svg class="w-12 h-12 mx-auto mb-3 text-warmgray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                        <p>Select an employer to view details</p>
                    </div>
                    <div id="unifiedDetail" class="hidden p-4">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Legend -->
            <div class="px-6 py-3 border-t border-warmgray-200 bg-warmgray-50 text-xs text-warmgray-500">
                <div class="flex items-center gap-4 flex-wrap">
                    <span class="font-semibold text-warmgray-700">Sources:</span>
                    <span><span class="inline-block px-2 py-0.5 rounded text-xs font-semibold bg-blue-100 text-blue-700 mr-1">F7</span> Private sector CBAs</span>
                    <span><span class="inline-block px-2 py-0.5 rounded text-xs font-semibold bg-purple-100 text-purple-700 mr-1">NLRB</span> Election participants</span>
                    <span><span class="inline-block px-2 py-0.5 rounded text-xs font-semibold bg-green-100 text-green-700 mr-1">VR</span> Voluntary recognition</span>
                    <span><span class="inline-block px-2 py-0.5 rounded text-xs font-semibold bg-orange-100 text-orange-700 mr-1">PUBLIC</span> Public sector</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- NLRB ELECTIONS MODAL -->
    <!-- ============================================ -->
    <div id="electionsModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col m-4">
            <!-- Modal header -->
            <div class="px-6 py-4 border-b border-warmgray-200 flex justify-between items-center flex-shrink-0 bg-gradient-to-r from-blue-50 to-white">
                <div>
                    <h2 class="headline text-xl font-bold text-warmgray-900 flex items-center gap-2">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                        </svg>
                        NLRB Elections
                    </h2>
                    <p class="text-sm text-warmgray-500">Union representation elections from NLRB</p>
                </div>
                <button onclick="closeElectionsModal()" class="text-warmgray-400 hover:text-warmgray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- Filters -->
            <div class="px-6 py-4 border-b border-warmgray-200 bg-warmgray-50">
                <div class="flex gap-4 items-end flex-wrap">
                    <div class="flex-1 min-w-48">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Employer Name</label>
                        <input type="text" id="electionsEmployerSearch" placeholder="Search by employer name..."
                            class="w-full px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">State</label>
                        <select id="electionsState" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                            <option value="">All States</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Year</label>
                        <select id="electionsYear" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                            <option value="">All Years</option>
                            <option value="2025">2025</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                            <option value="2020">2020</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Result</label>
                        <select id="electionsResult" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                            <option value="">All Results</option>
                            <option value="won">Union Won</option>
                            <option value="lost">Union Lost</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Min Voters</label>
                        <input type="number" id="electionsMinVoters" value="" min="1" placeholder="Any"
                            class="w-20 px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="electionsExcludeLawFirms" checked
                            class="w-4 h-4 rounded border-warmgray-300 text-blue-600 focus:ring-blue-500">
                        <label for="electionsExcludeLawFirms" class="text-xs text-warmgray-600">Exclude law firms</label>
                    </div>
                    <button onclick="loadElections()"
                        class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors">
                        Search
                    </button>
                </div>
            </div>

            <!-- Loading state -->
            <div id="electionsLoading" class="hidden p-12 text-center">
                <div class="inline-block w-8 h-8 border-4 border-warmgray-300 border-t-blue-600 rounded-full animate-spin mb-4"></div>
                <p class="text-warmgray-600">Loading elections...</p>
            </div>

            <!-- Results -->
            <div id="electionsContent" class="flex-1 overflow-hidden flex">
                <!-- Results list -->
                <div class="w-1/2 border-r border-warmgray-200 overflow-y-auto">
                    <div id="electionsResultsInfo" class="px-4 py-2 bg-warmgray-50 text-sm text-warmgray-500 border-b border-warmgray-200">
                        Click "Search" to find elections
                    </div>
                    <div id="electionsResults" class="divide-y divide-warmgray-100">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Detail panel -->
                <div class="w-1/2 overflow-y-auto">
                    <div id="electionsDetailEmpty" class="p-8 text-center text-warmgray-400">
                        <svg class="w-12 h-12 mx-auto mb-3 text-warmgray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                        </svg>
                        <p>Select an election to view details</p>
                    </div>
                    <div id="electionsDetail" class="hidden p-4">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Legend -->
            <div class="px-6 py-3 border-t border-warmgray-200 bg-warmgray-50 text-xs text-warmgray-500">
                <div class="flex items-center gap-4 flex-wrap">
                    <span class="font-semibold text-warmgray-700">Results:</span>
                    <span><span class="inline-block px-2 py-0.5 rounded text-xs font-semibold bg-green-100 text-green-700 mr-1">WON</span> Union certified</span>
                    <span><span class="inline-block px-2 py-0.5 rounded text-xs font-semibold bg-red-100 text-red-700 mr-1">LOST</span> Union not certified</span>
                    <span><span class="inline-block px-2 py-0.5 rounded text-xs font-semibold bg-yellow-100 text-yellow-700 mr-1">PENDING</span> In progress</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- PUBLIC SECTOR MODAL -->
    <!-- ============================================ -->
    <div id="publicSectorModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-6xl max-h-[90vh] overflow-hidden flex flex-col m-4">
            <!-- Modal header -->
            <div class="px-6 py-4 border-b border-warmgray-200 flex justify-between items-center flex-shrink-0 bg-gradient-to-r from-orange-50 to-white">
                <div>
                    <h2 class="headline text-xl font-bold text-warmgray-900 flex items-center gap-2">
                        <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"/>
                        </svg>
                        Public Sector
                    </h2>
                    <p class="text-sm text-warmgray-500">Public sector unions and employers</p>
                </div>
                <button onclick="closePublicSectorModal()" class="text-warmgray-400 hover:text-warmgray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- Sub-view toggle -->
            <div class="px-6 py-3 border-b border-warmgray-200 bg-warmgray-50">
                <div class="inline-flex gap-1 p-1 bg-warmgray-200 rounded-full">
                    <button id="psLocalsTab" onclick="setPublicSectorView('locals')"
                        class="px-4 py-1.5 text-sm font-semibold rounded-full transition-all bg-warmgray-900 text-white">
                        Union Locals
                    </button>
                    <button id="psEmployersTab" onclick="setPublicSectorView('employers')"
                        class="px-4 py-1.5 text-sm font-semibold rounded-full transition-all text-warmgray-600 hover:text-warmgray-800">
                        Employers
                    </button>
                </div>
            </div>

            <!-- Filters for Locals -->
            <div id="psLocalsFilters" class="px-6 py-4 border-b border-warmgray-200 bg-white">
                <div class="flex gap-4 items-end flex-wrap">
                    <div class="flex-1 min-w-48">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Name Search</label>
                        <input type="text" id="psLocalsNameSearch" placeholder="Search union locals..."
                            class="w-full px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">State</label>
                        <select id="psLocalsState" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                            <option value="">All States</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Parent Union</label>
                        <select id="psLocalsParent" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                            <option value="">All Unions</option>
                        </select>
                    </div>
                    <button onclick="loadPublicSectorLocals()"
                        class="px-6 py-2 bg-orange-600 text-white font-semibold rounded-lg hover:bg-orange-700 transition-colors">
                        Search
                    </button>
                </div>
            </div>

            <!-- Filters for Employers (hidden by default) -->
            <div id="psEmployersFilters" class="px-6 py-4 border-b border-warmgray-200 bg-white hidden">
                <div class="flex gap-4 items-end flex-wrap">
                    <div class="flex-1 min-w-48">
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Name Search</label>
                        <input type="text" id="psEmployersNameSearch" placeholder="Search employers..."
                            class="w-full px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">State</label>
                        <select id="psEmployersState" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                            <option value="">All States</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Employer Type</label>
                        <select id="psEmployersType" class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                            <option value="">All Types</option>
                        </select>
                    </div>
                    <button onclick="loadPublicSectorEmployers()"
                        class="px-6 py-2 bg-orange-600 text-white font-semibold rounded-lg hover:bg-orange-700 transition-colors">
                        Search
                    </button>
                </div>
            </div>

            <!-- Loading state -->
            <div id="publicSectorLoading" class="hidden p-12 text-center">
                <div class="inline-block w-8 h-8 border-4 border-warmgray-300 border-t-orange-600 rounded-full animate-spin mb-4"></div>
                <p class="text-warmgray-600">Loading...</p>
            </div>

            <!-- Results -->
            <div id="publicSectorContent" class="flex-1 overflow-hidden flex">
                <!-- Results list -->
                <div class="w-1/2 border-r border-warmgray-200 overflow-y-auto">
                    <div id="publicSectorResultsInfo" class="px-4 py-2 bg-warmgray-50 text-sm text-warmgray-500 border-b border-warmgray-200">
                        Click "Search" to browse public sector data
                    </div>
                    <div id="publicSectorResults" class="divide-y divide-warmgray-100">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Detail panel -->
                <div class="w-1/2 overflow-y-auto">
                    <div id="publicSectorDetailEmpty" class="p-8 text-center text-warmgray-400">
                        <svg class="w-12 h-12 mx-auto mb-3 text-warmgray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z"/>
                        </svg>
                        <p>Select an item to view details</p>
                    </div>
                    <div id="publicSectorDetail" class="hidden p-4">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Legend -->
            <div class="px-6 py-3 border-t border-warmgray-200 bg-warmgray-50 text-xs text-warmgray-500">
                <div class="flex items-center gap-4 flex-wrap">
                    <span class="font-semibold text-warmgray-700">Employer Types:</span>
                    <span><span class="inline-block px-2 py-0.5 rounded text-xs font-semibold bg-blue-100 text-blue-700 mr-1">FEDERAL</span></span>
                    <span><span class="inline-block px-2 py-0.5 rounded text-xs font-semibold bg-purple-100 text-purple-700 mr-1">STATE</span></span>
                    <span><span class="inline-block px-2 py-0.5 rounded text-xs font-semibold bg-orange-100 text-orange-700 mr-1">COUNTY</span></span>
                    <span><span class="inline-block px-2 py-0.5 rounded text-xs font-semibold bg-green-100 text-green-700 mr-1">CITY</span></span>
                    <span><span class="inline-block px-2 py-0.5 rounded text-xs font-semibold bg-yellow-100 text-yellow-700 mr-1">SCHOOL</span></span>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- TRENDS DASHBOARD MODAL -->
    <!-- ============================================ -->
    <div id="trendsModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50 overflow-y-auto">
        <div class="bg-cream rounded-xl shadow-2xl w-full max-w-7xl min-h-[85vh] m-4">
            <!-- Modal header -->
            <div class="sticky top-0 z-10 bg-gradient-to-r from-emerald-700 to-emerald-600 text-white rounded-t-xl px-6 py-4 flex justify-between items-center">
                <div>
                    <h2 class="headline text-xl font-bold flex items-center gap-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"/>
                        </svg>
                        Trends & Analytics
                    </h2>
                    <p class="text-emerald-200 text-sm">Historical membership and election trends (2010-2024)</p>
                </div>
                <button onclick="closeTrendsModal()" class="text-emerald-200 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- Sub-tabs -->
            <div class="bg-white border-b border-warmgray-200 px-6 py-3">
                <div class="flex gap-2">
                    <button id="trendsTabOverview" onclick="setTrendsTab('overview')"
                        class="px-4 py-2 text-sm font-semibold rounded-lg bg-emerald-100 text-emerald-700">
                        Overview
                    </button>
                    <button id="trendsTabMembership" onclick="setTrendsTab('membership')"
                        class="px-4 py-2 text-sm font-semibold rounded-lg text-warmgray-600 hover:bg-warmgray-100">
                        Membership Trends
                    </button>
                    <button id="trendsTabElections" onclick="setTrendsTab('elections')"
                        class="px-4 py-2 text-sm font-semibold rounded-lg text-warmgray-600 hover:bg-warmgray-100">
                        Election Trends
                    </button>
                    <button id="trendsTabByState" onclick="setTrendsTab('byState')"
                        class="px-4 py-2 text-sm font-semibold rounded-lg text-warmgray-600 hover:bg-warmgray-100">
                        By State
                    </button>
                    <button id="trendsTabByAffiliation" onclick="setTrendsTab('byAffiliation')"
                        class="px-4 py-2 text-sm font-semibold rounded-lg text-warmgray-600 hover:bg-warmgray-100">
                        By Affiliation
                    </button>
                </div>
            </div>

            <!-- Loading state -->
            <div id="trendsLoading" class="p-12 text-center">
                <div class="inline-block w-10 h-10 border-4 border-warmgray-300 border-t-emerald-600 rounded-full animate-spin mb-4"></div>
                <p class="text-warmgray-600">Loading trends data...</p>
            </div>

            <!-- Content panels -->
            <div id="trendsContent" class="hidden p-6">
                <!-- Overview Panel -->
                <div id="trendsPanelOverview">
                    <div class="grid grid-cols-4 gap-4 mb-6">
                        <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                            <div class="text-xs font-semibold text-warmgray-500 uppercase">Total Members (2024)</div>
                            <div id="trendsMembers2024" class="text-2xl font-bold text-warmgray-900 mt-1">—</div>
                            <div id="trendsMembersChange" class="text-sm text-warmgray-500 mt-1"></div>
                        </div>
                        <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                            <div class="text-xs font-semibold text-warmgray-500 uppercase">Avg Annual Change</div>
                            <div id="trendsAvgChange" class="text-2xl font-bold text-warmgray-900 mt-1">—</div>
                        </div>
                        <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                            <div class="text-xs font-semibold text-warmgray-500 uppercase">Election Win Rate</div>
                            <div id="trendsWinRate" class="text-2xl font-bold text-emerald-600 mt-1">—</div>
                        </div>
                        <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                            <div class="text-xs font-semibold text-warmgray-500 uppercase">Elections (2024)</div>
                            <div id="trendsElections2024" class="text-2xl font-bold text-warmgray-900 mt-1">—</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                            <h3 class="text-sm font-semibold text-warmgray-700 uppercase mb-4">Membership Over Time</h3>
                            <div class="h-64">
                                <canvas id="trendsOverviewChart"></canvas>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                            <h3 class="text-sm font-semibold text-warmgray-700 uppercase mb-4">Election Outcomes</h3>
                            <div class="h-64">
                                <canvas id="trendsElectionsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Membership Panel -->
                <div id="trendsPanelMembership" class="hidden">
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200 mb-6">
                        <h3 class="text-sm font-semibold text-warmgray-700 uppercase mb-4">National Membership (2010-2024)</h3>
                        <div class="h-80">
                            <canvas id="trendsMembershipChart"></canvas>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                            <h4 class="text-xs font-semibold text-warmgray-500 uppercase mb-3">Top Growing Affiliations</h4>
                            <div id="trendsTopGrowing" class="space-y-2 text-sm"></div>
                        </div>
                        <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                            <h4 class="text-xs font-semibold text-warmgray-500 uppercase mb-3">Declining Affiliations</h4>
                            <div id="trendsDeclining" class="space-y-2 text-sm"></div>
                        </div>
                        <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                            <h4 class="text-xs font-semibold text-warmgray-500 uppercase mb-3">Sector Breakdown</h4>
                            <div id="trendsSectors" class="space-y-2 text-sm"></div>
                        </div>
                    </div>
                </div>

                <!-- Elections Panel -->
                <div id="trendsPanelElections" class="hidden">
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200 mb-6">
                        <h3 class="text-sm font-semibold text-warmgray-700 uppercase mb-4">Election Outcomes by Year</h3>
                        <div class="h-80">
                            <canvas id="trendsElectionsByYearChart"></canvas>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                            <h4 class="text-xs font-semibold text-warmgray-500 uppercase mb-3">Win Rate by Year</h4>
                            <div id="trendsWinRateByYear" class="space-y-2 text-sm max-h-48 overflow-y-auto"></div>
                        </div>
                        <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200">
                            <h4 class="text-xs font-semibold text-warmgray-500 uppercase mb-3">Elections by State (Top 10)</h4>
                            <div id="trendsElectionsByState" class="space-y-2 text-sm max-h-48 overflow-y-auto"></div>
                        </div>
                    </div>
                </div>

                <!-- By State Panel -->
                <div id="trendsPanelByState" class="hidden">
                    <div class="mb-4 flex gap-4 items-end">
                        <div>
                            <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Select State</label>
                            <select id="trendsStateSelect" onchange="loadStateTrends()"
                                class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                                <option value="">Choose a state...</option>
                            </select>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200 mb-6">
                        <h3 class="text-sm font-semibold text-warmgray-700 uppercase mb-4">State Membership Trend</h3>
                        <div class="h-80">
                            <canvas id="trendsStateChart"></canvas>
                        </div>
                    </div>
                    <div id="trendsStateInfo" class="grid grid-cols-3 gap-4">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- By Affiliation Panel -->
                <div id="trendsPanelByAffiliation" class="hidden">
                    <div class="mb-4 flex gap-4 items-end">
                        <div>
                            <label class="block text-xs font-semibold text-warmgray-500 uppercase tracking-wide mb-1">Select Affiliation</label>
                            <select id="trendsAffiliationSelect" onchange="loadAffiliationTrends()"
                                class="px-3 py-2 border border-warmgray-300 rounded-lg text-sm">
                                <option value="">Choose an affiliation...</option>
                            </select>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-sm border border-warmgray-200 mb-6">
                        <h3 class="text-sm font-semibold text-warmgray-700 uppercase mb-4">Affiliation Membership Trend</h3>
                        <div class="h-80">
                            <canvas id="trendsAffiliationChart"></canvas>
                        </div>
                    </div>
                    <div id="trendsAffiliationInfo" class="grid grid-cols-3 gap-4">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Freshness Footer -->
    <div id="freshnessFooter" class="hidden fixed bottom-0 left-0 right-0 bg-warmgray-800 text-warmgray-300 text-xs py-1.5 px-6 z-30">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <span id="freshnessFooterText">Loading data freshness...</span>
            <button onclick="openFreshnessModal()" class="text-warmgray-400 hover:text-white underline ml-4">View Details</button>
        </div>
    </div>

    <!-- Data Freshness Modal -->
    <div id="freshnessModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center" onclick="if(event.target===this)closeFreshnessModal()">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[80vh] overflow-hidden mx-4">
            <div class="flex justify-between items-center px-6 py-4 border-b border-warmgray-200">
                <h2 class="text-lg font-bold text-warmgray-900">Data Source Freshness</h2>
                <button onclick="closeFreshnessModal()" class="text-warmgray-400 hover:text-warmgray-700 text-2xl leading-none">&times;</button>
            </div>
            <div class="px-6 py-4 overflow-y-auto max-h-[65vh]">
                <div id="freshnessModalContent">Loading...</div>
            </div>
        </div>
    </div>

    <!-- External JS files (load order matters) -->
    <script src="/files/js/config.js"></script>
    <script src="/files/js/utils.js"></script>
    <script src="/files/js/maps.js"></script>
    <script src="/files/js/territory.js"></script>
    <script src="/files/js/search.js"></script>
    <script src="/files/js/deepdive.js"></script>
    <script src="/files/js/detail.js"></script>
    <script src="/files/js/scorecard.js"></script>
    <script src="/files/js/modals.js"></script>
    <script src="/files/js/app.js"></script>
</body>
</html>
